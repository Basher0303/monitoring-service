<template lang="">
    <div class="main">
        <div class="header">
            <div class="icon" @click="$router.push('/')">
                <g
                    data-v-0dd9719b=""
                    fill="#1A1A1A"
                    class="icon-text-wrapper icon-svg-group iconsvg"
                    transform="translate(97.52000427246094,109.45323753356934)"
                    ><g class="iconsvg-imagesvg" transform="translate(0,0)"
                        ><g
                            ><rect
                                fill="#1A1A1A"
                                fill-opacity="0"
                                stroke-width="2"
                                x="0"
                                y="0"
                                width="31.19999999999996"
                                height="30.837047945679316"
                                class="image-rect"
                            ></rect>
                            <svg
                                x="0"
                                y="0"
                                width="31.19999999999996"
                                height="30.837047945679316"
                                filtersec="colorsb4835661205"
                                class="image-svg-svg primary"
                                style="overflow: visible"
                            >
                                <svg
                                    xmlns="http://www.w3.org/2000/svg"
                                    viewBox="-0.003277458483353257 0 51.00327682495117 50.410003662109375"
                                >
                                    <title>v6</title>
                                    <g data-name="图层 2">
                                        <g data-name="Layer 1">
                                            <path
                                                d="M10.71 9.12a6.07 6.07 0 0 1 5.21 3C14 8.27 13 6.34 13 6.33Q10.55 0 6.57 0h-1a3.06 3.06 0 0 0-.81.11Q0 1.72 0 5.66v.77a2.3 2.3 0 0 0 .21 1.09q0 .29 5 10.34a6.07 6.07 0 0 1 5.46-8.74zM40.31 9.17a6 6 0 0 1 5.54 8.44Q51 7.78 51 6.82V5.34a4 4 0 0 0-.53-1.86Q48.48 0 45.39 0h-1A5.66 5.66 0 0 0 40 2.46l-5 9.84a6 6 0 0 1 5.31-3.13z"
                                                fill="#1a1a1a"
                                            ></path>
                                            <path
                                                d="M15.92 12.09l.42.84a6.05 6.05 0 0 0-.42-.84zM5.4 18.14l-.14-.28zM34.94 12.47l.06-.17zM45.49 18.31a6 6 0 0 0 .36-.7z"
                                                fill="#f7931e"
                                            ></path>
                                            <path
                                                d="M40.31 9.17A6 6 0 0 0 35 12.3l-.09.17Q25.56 31 25.42 31.11q-6-12-9.07-18.19l-.42-.84a6.07 6.07 0 0 0-10.68 5.78l.14.28Q10 27.39 18.84 44.68 21 50.41 25 50.41h1.09a5.73 5.73 0 0 0 4.18-2.18q.53-.7 14.87-29.32l.31-.6.36-.7a6 6 0 0 0-5.54-8.44z"
                                                fill="#00a99d"
                                            ></path>
                                        </g>
                                    </g>
                                </svg>
                            </svg>
                            <!----></g
                        ></g
                    >
                    <g transform="translate(32.20000076293945,9.743523597717285)"
                        ><g data-gra="path-name" fill-rule="" class="tp-name iconsvg-namesvg"
                            ><g transform="scale(1)"
                                ><g
                                    ><path
                                        d="M7.01-15.03L7.01 0 1.82 0 1.82-15.03 7.01-15.03ZM1.69-18.77L1.69-18.77Q1.69-19.94 2.34-20.51 2.99-21.08 4.43-21.08L4.43-21.08Q5.88-21.08 6.54-20.5 7.2-19.92 7.2-18.77L7.2-18.77Q7.2-16.49 4.43-16.49L4.43-16.49Q1.69-16.49 1.69-18.77ZM22.24-4.62L22.24-4.62Q22.24-2.2 20.59-0.97 18.95 0.27 15.87 0.27L15.87 0.27Q14.2 0.27 12.96 0.09 11.73-0.09 10.44-0.57L10.44-0.57 10.44-4.72Q11.65-4.19 13.09-3.85 14.53-3.5 15.66-3.5L15.66-3.5Q17.34-3.5 17.34-4.27L17.34-4.27Q17.34-4.67 16.87-4.98 16.4-5.29 14.13-6.2L14.13-6.2Q12.06-7.05 11.24-8.13 10.42-9.21 10.42-10.87L10.42-10.87Q10.42-12.96 12.03-14.13 13.65-15.3 16.61-15.3L16.61-15.3Q18.1-15.3 19.41-14.97 20.71-14.65 22.12-14.02L22.12-14.02 20.71-10.68Q19.68-11.15 18.52-11.47 17.37-11.8 16.64-11.8L16.64-11.8Q15.36-11.8 15.36-11.17L15.36-11.17Q15.36-10.79 15.81-10.52 16.25-10.24 18.38-9.41L18.38-9.41Q19.96-8.76 20.73-8.13 21.51-7.51 21.87-6.67 22.24-5.82 22.24-4.62ZM38.86 0L33.87 0 29.91-13.97 29.79-13.97Q30.07-10.4 30.07-8.43L30.07-8.43 30.07 0 25.42 0 25.42-19.4 32.4-19.4 36.45-5.63 36.55-5.63 40.52-19.4 47.51-19.4 47.51 0 42.7 0 42.7-8.51Q42.7-9.17 42.72-9.98 42.74-10.79 42.9-13.95L42.9-13.95 42.78-13.95 38.86 0ZM58.65 0.27L58.65 0.27Q54.89 0.27 52.82-1.73 50.74-3.73 50.74-7.42L50.74-7.42Q50.74-11.23 52.66-13.26 54.59-15.3 58.16-15.3L58.16-15.3Q61.55-15.3 63.4-13.53 65.25-11.76 65.25-8.43L65.25-8.43 65.25-6.12 55.98-6.12Q56.03-4.86 56.9-4.14 57.77-3.42 59.27-3.42L59.27-3.42Q60.64-3.42 61.78-3.68 62.93-3.94 64.27-4.56L64.27-4.56 64.27-0.84Q63.05-0.21 61.75 0.03 60.45 0.27 58.65 0.27ZM58.34-11.77L58.34-11.77Q57.43-11.77 56.81-11.19 56.19-10.61 56.09-9.38L56.09-9.38 60.54-9.38Q60.52-10.47 59.93-11.12 59.34-11.77 58.34-11.77ZM75.55-3.83L75.55-3.83Q76.6-3.83 78.06-4.35L78.06-4.35 78.06-0.57Q77.01-0.12 76.06 0.07 75.11 0.27 73.84 0.27L73.84 0.27Q71.23 0.27 70.07-1.02 68.92-2.3 68.92-4.95L68.92-4.95 68.92-11.15 67.1-11.15 67.1-13.26 69.41-14.89 70.75-18.05 74.14-18.05 74.14-15.03 77.83-15.03 77.83-11.15 74.14-11.15 74.14-5.29Q74.14-3.83 75.55-3.83ZM89.76-15.3L89.76-15.3Q90.44-15.3 91.05-15.19L91.05-15.19 91.34-15.14 90.88-10.24Q90.24-10.4 89.11-10.4L89.11-10.4Q87.41-10.4 86.64-9.63 85.87-8.85 85.87-7.39L85.87-7.39 85.87 0 80.69 0 80.69-15.03 84.55-15.03 85.36-12.63 85.61-12.63Q86.26-13.83 87.42-14.56 88.58-15.3 89.76-15.3ZM98.65-15.03L98.65 0 93.46 0 93.46-15.03 98.65-15.03ZM93.33-18.77L93.33-18.77Q93.33-19.94 93.98-20.51 94.63-21.08 96.08-21.08L96.08-21.08Q97.52-21.08 98.19-20.5 98.85-19.92 98.85-18.77L98.85-18.77Q98.85-16.49 96.08-16.49L96.08-16.49Q93.33-16.49 93.33-18.77ZM109.12 0.27L109.12 0.27Q105.43 0.27 103.53-1.72 101.62-3.72 101.62-7.44L101.62-7.44Q101.62-11.19 103.68-13.24 105.74-15.3 109.53-15.3L109.53-15.3Q112.15-15.3 114.45-14.16L114.45-14.16 112.93-10.32Q111.99-10.73 111.19-10.98 110.39-11.23 109.53-11.23L109.53-11.23Q108.27-11.23 107.58-10.24 106.89-9.26 106.89-7.47L106.89-7.47Q106.89-3.86 109.56-3.86L109.56-3.86Q111.84-3.86 113.94-5.19L113.94-5.19 113.94-1.06Q111.93 0.27 109.12 0.27Z"
                                        transform="translate(-1.690000057220459, 21.079999923706055)"
                                    ></path
                                ></g>
                                <!---->
                                <!---->
                                <!---->
                                <!---->
                                <!---->
                                <!---->
                                <!----></g
                            ></g
                        >
                        <!----></g
                    ></g
                >
                <span style="font-weight: 500; font-size: 32px">isMetric</span>
            </div>
            <div class="title">{{ title }}</div>
        </div>
        <div class="button-group">
            <NButton
                v-if="options.includes('createPanel')"
                secondary
                type="success"
                @click="$emit('create')"
            >
                <template #icon>
                    <NIcon><Icon icon="ic:baseline-addchart" /></NIcon>
                </template>
                <template #default>
                    <span style="font-weight: 500">Создать приборнуню панель</span>
                </template>
            </NButton>
            <NButton
                v-if="options.includes('createCard')"
                secondary
                type="success"
                @click="$router.push('/dashboard/create/' + $route.params.id)"
            >
                <template #icon>
                    <NIcon><Icon icon="ic:baseline-addchart" /></NIcon>
                </template>
                <template #default><span style="font-weight: 500">Добавить</span></template>
            </NButton>
            <NSelect
                v-if="options.includes('timeRange')"
                :options="selectTimeRangeOptions"
                :consistent-menu-width="false"
                placeholder="Временной интервал"
                class="select-time-range"
            />
            <NInputGroup v-if="options.includes('timeUpdate')" class="select-time-update">
                <NButton strong>
                    <template #icon>
                        <NIcon><Icon icon="tabler:reload" /></NIcon>
                    </template>
                </NButton>
                <NSelect
                    v-model:value="timeUpdateValue"
                    :options="selectTimeUpdateOptions"
                    :consistent-menu-width="false"
                    placeholder="Период обновления"
                />
            </NInputGroup>
            <NDropdown
                trigger="click"
                :options="dropdownProfileOptions"
                showArrow
                @select="handleSelectProfile"
            >
                <NButton strong secondary type="primary">
                    <template #icon>
                        <NIcon><Icon icon="ph:user-bold" /></NIcon>
                    </template>
                    <template #default>
                        <span style="font-weight: 500">Мой профиль</span>
                    </template>
                </NButton>
            </NDropdown>
        </div>
    </div>
</template>

<script>
import { NButton, NIcon, NSelect, NInputGroup, NDropdown } from 'naive-ui'
import { Icon } from '@iconify/vue'
import { mapMutations, mapGetters, mapActions } from 'vuex'
import { h } from 'vue'
export default {
    components: {
        NButton,
        NIcon,
        NSelect,
        NInputGroup,
        NDropdown,
        Icon
    },
    props: {
        title: String,
        options: {
            type: Array,
            default: () => ['createPanel', 'createCard', 'timeRange', 'timeUpdate']
        }
    },
    emist: ['create'],
    data() {
        return {}
    },
    created() {
        this.selectTimeRangeOptions = [
            {
                label: 'за 1 час',
                value: '1'
            },
            {
                label: 'за 3 часа',
                value: '2'
            },
            {
                label: 'за 9 часов',
                value: '3'
            }
        ]

        this.selectTimeUpdateOptions = [
            {
                label: '1 минута',
                value: 60 * 1000
            },
            {
                label: '5 минут',
                value: 5 * 60 * 1000
            },
            {
                label: '10 минут',
                value: 10 * 60 * 1000
            }
        ]

        this.dropdownProfileOptions = [
            {
                label: 'Администрирование',
                key: 'admin',
                icon: () => h(NIcon, {}, h(Icon, { icon: 'eos-icons:admin-outlined' }))
            },
            {
                label: 'Настройки',
                key: 'settings',
                icon: () => h(NIcon, {}, h(Icon, { icon: 'material-symbols:settings-outline' }))
            },
            {
                label: 'Выйти из аккаунта',
                key: 'exit',
                icon: () => h(NIcon, {}, h(Icon, { icon: 'uil:exit' }))
            }
        ]
    },
    computed: {
        ...mapGetters('dashboard', ['getOptions']),
        timeUpdateValue: {
            get() {
                return this.getOptions.timeUpdate
            },
            set(value) {
                this.updateOptions({ key: 'timeUpdate', value: value })
            }
        }
    },
    methods: {
        ...mapMutations('user', ['clearInfo']),
        ...mapActions('dashboard', ['updateOptions']),
        handleSelectProfile(key) {
            if (key == 'admin') {
                this.$router.push('/admin')
            } else if (key == 'exit') {
                this.logout()
            }
        },
        async logout() {
            try {
                await this.$api.user.auth.logout()
                this.clearInfo()
                this.$router.push('/login')
            } catch (error) {
                console.log(error)
            }
        }
    }
}
</script>

<style scoped>
.main {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding-top: 24px;
    padding-bottom: 24px;
}

.header {
    display: flex;
    align-items: center;
    line-height: 38px;
}
.header .icon {
    display: flex;
    align-items: center;
    cursor: pointer;
}

.header .title {
    font-size: 24px;
    margin-left: 32px;
}
.button-group {
    display: flex;
}
.button-group > :not(:first-child) {
    margin-left: 10px;
}

.button-group .select-time-range {
    width: 200px;
}

.button-group .select-time-update {
    width: 250px;
}
</style>
